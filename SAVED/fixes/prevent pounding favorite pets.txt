In service/applicationservice/poundservice.php scroll to the bottom and where it says private function validatePound(), replace it with this:

PHP:

private function validatePound(OwnedAdoptable $adopt){
        $validations = new ArrayObject(["adopt", "owner", "number", "recurrence", "money", "favpet"]);
        $validator = new PoundValidator($adopt, $this->getCost($adopt, "pound"), $this->settings, $validations);
        $validator->validate();
    }


That adds a check for favpet, which we need to set up.

In service/validator/poundvalidator.php, scroll to the bottom and put this (but make sure it's before the last curly bracket!):

PHP:

protected function checkFavpet(){
        $mysidia = Registry::get("mysidia");
        $favpetID = $mysidia->db->select("users_profile", array("uid", "favpet"), "uid = '{$mysidia->user->getID()}'")->fetchObject();
        if($favpetID->favpet == $this->adopt->getAdoptID()){
            throw new PoundException("favpet");
        }


Then open lang/main/lang_pound.php and put this somewhere:

PHP:

$lang['favpet'] = "This adopt is your favpet! You cannot pound them!";


And that seems to work. When you go to pound an adopt it will throw the above error and if you go to manage the favpet you still have them.

Now, this happens if you go to the pound page and click the confirm button. But what if you want the page to look different and stop you seeing the option to pound them in the first place?

Open view/main/poundview.php, go to public function pound(), and add this line in:

PHP:

$favpetID = $mysidia->db->select("users_profile", array("uid", "favpet"), "uid = '{$mysidia->user->getID()}'")->fetchObject();


I put it underneath:

PHP:

$adopt = $this->getField("adopt");
$confirm = $this->getField("confirm");


Just so it stays at the top lol. Then find:

PHP:

if($confirm){
            $cost = $this->getField("cost");
            $document->setTitle($this->lang->pound_complete);
            $document->addLangvar($this->lang->pound_success);
            $document->addLangvar(" at a cost of {$cost->getValue()} {$mysidia->settings->cost}");
            $document->addLangvar($this->lang->afterwards);
            return;
        }


And underneath that put this:

PHP:

if($favpetID->favpet == $adopt->getAdoptID()){
            $document->setTitle("Oops!");
            $document->add(new Comment("You cannot pound your favpet!"));   
            return;
        }
